# Codex Execution Plans (ExecPlans)

このファイルは ExecPlan（実行計画）の書き方を定義する。ExecPlan は初心者でもこのファイルと現行ワークツリーだけを手がかりに、求められる成果物を再現できるようにするための「自己完結した生きた設計ドキュメント」である。

## 使い方

ExecPlan を書く／更新する前に本書を読み直すこと。`.md` ファイル全体が単一の ExecPlan になる場合は、三重バッククォートのフェンスは付けない。途中で中断・再開するときも Progress を最新状態にし、Decision Log と Surprises & Discoveries に判断や発見を必ず記録する。外部ブログや外部ドキュメントへの参照に頼らず、必要な前提は ExecPlan に自前で書き込む。

## 非交渉要件

- **完全自己完結**: 事前知識ゼロの初心者がこのファイルだけでゴールに到達できること。
- **生きた文書**: 実装を進めるたびに進捗・判断・発見・結果を反映し続けること。
- **観測可能な成果**: 単にコードがあるだけでなく、実際に動作を確認できる手順・証拠を含めること。
- **用語の明文化**: 専門用語を使うなら必ず平易に定義し、リポジトリ内のどこで現れるかを示すこと。

## 形式

- ExecPlan は `md` 言語ラベルの単一フェンスで包む（ただしファイル全体が計画のみの場合はフェンス不要）。
- 見出しの後は空行を 2 行入れ、箇条書きは必要最小限にする。チェックリストは Progress セクションのみで必須。
- コマンドや抜粋はインデントで示し、入れ子のフェンスは避ける。

## ガイドライン

- 意図と目的を最優先で説明し、ユーザーが何をできるようになるかを冒頭で述べる。
- 曖昧さは計画内で解消し、決定の理由を記録する。外部判断に委ねない。
- 具体的なファイルパス、関数・モジュール名、実行ディレクトリとコマンドを明記する。
- 再実行やリトライの方法を記す。破壊的操作には回避策やバックアップを添える。
- 検証は必須。期待される出力やログ例を短く示し、成功／失敗の見分け方を書く。

## マイルストン

各マイルストンは「目的・作業・結果・検証」を短く物語るように書く。段階ごとに独立して確認でき、全体ゴールに漸進すること。

## 記録すべきセクション

- Progress: チェックボックス付きで現状を正確に示す。停止時点を必ず記録する。
- Surprises & Discoveries: 予想外の挙動・バグ・最適化などを証跡付きで記録。
- Decision Log: すべての判断を理由と日時付きで残す。
- Outcomes & Retrospective: 節目や完了時に成果・残課題・学びをまとめる。

## プロトタイピング

不確実性が高い場合は小さな PoC やスパイクをマイルストンに含め、検証方法と採否基準を明確にする。本実装とは併存させ、どの時点で破棄／昇格するかを書く。

## 良い ExecPlan のスケルトン

```md
# <短く行動指向のタイトル>

この ExecPlan は生きた文書。Progress / Surprises & Discoveries / Decision Log / Outcomes & Retrospective を随時更新し、`.agent/PLANS.md` の要件に従う。

## Purpose / Big Picture

<変更によって何ができるようになるか、ユーザー視点で平易に説明>

## Progress

- [x] (2025-10-01 13:00Z) 例: 完了した作業
- [ ] 例: 未完了の作業
- [ ] 例: 部分完了の作業（完了: X / 残り: Y）

## Surprises & Discoveries

- Observation: …
  Evidence: …

## Decision Log

- Decision: …
  Rationale: …
  Date/Author: …

## Outcomes & Retrospective

<節目ごとの成果・残課題・学び>

## Context and Orientation

<前提・現状・主要ファイル・用語の説明>

## Plan of Work

<どのファイルをどう編集／追加するかを順序立てて散文で書く>

## Concrete Steps

<実行ディレクトリと具体的コマンド、期待される短い出力例>

## Validation and Acceptance

<挙動ベースでの受け入れ条件、必要ならテストコマンドと期待結果を記載>

## Idempotence and Recovery

<再実行可否、失敗時のリカバリ手順>

## Artifacts and Notes

<重要な抜粋やログ例>

## Interfaces and Dependencies

<使用するライブラリや公開する型・関数シグネチャを具体的に指定>
```

計画を改訂したら、変更点と理由を末尾にメモし、全セクションを一貫した内容に保つこと。
